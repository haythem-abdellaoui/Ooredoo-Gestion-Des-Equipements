<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ooredoo - Gestion des Stocks</title>

  <!-- Google Fonts (Roboto) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS (à charger avant ton CSS perso) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Ton CSS personnalisé (toujours en dernier pour qu’il ne soit pas écrasé) -->
  <link rel="stylesheet" href="{{ asset('css/style.css') }}">
  <style>
.stat-card {
  transition: transform 0.2s;
}
.stat-card:hover {
  transform: scale(1.05);
}
</style>
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar shadow-sm rounded-end animate__animated animate__fadeInLeft">
      <div class="sidebar-header">
        <div><img src ="{{asset('images/ooredoo4.png')}}" width="175" height="48" ></div>
      </div>
      <nav>
       <ul>
          <li><a href="{{path('app_')}}" style="text-decoration:none; color:inherit;"> Tableau De Bord </a></li>
          <li><a href="{{ path('ajouter_equipement') }}" style="text-decoration:none; color:inherit;">Ajouter Des Equipements</a></li>
          <li class="active"><a href="{{ path('statistiques') }}" style="text-decoration:none; color:inherit;">Statistiques</a></li>
          <li><a href="{{ path('parametres') }}"style="text-decoration:none; color:inherit;"> Paramètres </a></li>
          <li><a href="{{ path('predire_panne') }}"style="text-decoration:none; color:inherit;"> Prédire Une Panne </a></li>
          <li><a href="{{ path('logout') }}"style="text-decoration:none; color:inherit;"> Se Déconnecter </a></li>

        </ul>
      </nav>
    </aside>
    <main class="main-content">
      <div class="container py-5">
        <div class="row g-4">
          <div class="col-md-3">
            <div class="stat-card bg-danger text-white text-center p-4 rounded shadow animate__animated animate__fadeInUp">
              <div class="stat-label mb-2">Total Équipements</div>
              <div class="stat-value display-4 fw-bold" id="stat-total">0</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card bg-success text-white text-center p-4 rounded shadow animate__animated animate__fadeInUp animate__delay-1s">
              <div class="stat-label mb-2">En Stock</div>
              <div class="stat-value display-4 fw-bold" id="stat-enstock">0</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card bg-warning text-dark text-center p-4 rounded shadow animate__animated animate__fadeInUp animate__delay-2s">
              <div class="stat-label mb-2">Stock Bas</div>
              <div class="stat-value display-4 fw-bold">{{ stockBas }}</div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="stat-card bg-secondary text-white text-center p-4 rounded shadow animate__animated animate__fadeInUp animate__delay-3s">
              <div class="stat-label mb-2">Rupture</div>
              <div class="stat-value display-4 fw-bold">{{ rupture }}</div>
            </div>
          </div>
        </div>
        <div class="row mt-5">
          <div class="col-12">
            <canvas id="etatChart" width="400" height="400" style="max-width:400px; max-height:400px; display:block; margin:auto;"></canvas>
          </div>
        </div>
      </div>
    </main>
  </div>
  <!-- Bootstrap JS (pour les animations et composants interactifs) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoA6DQD1KQ9Q8cbh6wr6LrZ8p1ztB1zBOeEnQyZ0P5hF6Q" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Validation Bootstrap custom
    (() => {
      'use strict';
      const forms = document.querySelectorAll('.needs-validation');
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault(); // Empêche l’envoi si invalide
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    })();

function animateValue(id, start, end, duration) {
  let range = end - start;
  let current = start;
  let increment = end > start ? 1 : -1;
  let stepTime = Math.abs(Math.floor(duration / range));
  const obj = document.getElementById(id);
  let timer = setInterval(function() {
    current += increment;
    obj.textContent = current;
    if (current == end) {
      clearInterval(timer);
    }
  }, stepTime);
}

document.addEventListener('DOMContentLoaded', function() {
  animateValue("stat-total", 0, {{ total }}, 1000);
  animateValue("stat-enstock", 0, {{ enStock }}, 1000);

  // Préparer les données pour Chart.js
  const etatLabels = [
    {% for etat in etatCounts %}
      "{{ etat.etat }}",
    {% endfor %}
  ];
  const etatData = [
    {% for etat in etatCounts %}
      {{ etat.nb }},
    {% endfor %}
  ];

  const ctx = document.getElementById('etatChart').getContext('2d');
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: etatLabels,
      datasets: [{
        data: etatData,
        backgroundColor: [
          '#dc3545', '#198754', '#ffc107', '#6c757d', '#0d6efd'
        ],
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });
});
  </script>
  
</body>
</html> 